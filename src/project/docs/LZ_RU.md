# LZ
Этот алгоритм основан на известном алгоритме LZ77, то есть для сжатия данных
в блоке данных ищутся совпадения с тем уже встречалось ранее и вместо 
повторной записи этих данных оставляется ссылка на них.

Подразумевается, что для корректной работы алгоритма размер блока не превышает
2^24Б, иначе может не получится нормально сослаться на совпадение.

Для реализации алгоритма были использованы классы:
- LZEncoder (логика кодирования)
- LZDecoder (логика декодирования)
- [BitInputStream](./BitStreams_RU.md)
- [BitOutputStream](./BitStreams_RU.md)
- Match (объект, который хранит в себе информациюу о длине совпадения и смещении до совпадения
  от текущего элемента)

Примечание: для поиска самого длинного совпадения используется обычный линейный
            поиск. Скорее всего - это сильно тормозит сжатие больших файлов. 
            За это отвечает метод findLongestMatch(byte[] data, int fromIndex) в 
            LZEncoder

### Изменения относительно стандартного LZ77
Эта реализация имеет некоторые модификации. Для того, чтобы не делать ссылки на
слишком короткие совпадения (например, длиной всего в 1Б), ставится 1 флаговый 
бит, который указывает, какие данные будут дальше закодированные (флаговый
бит - 1) или нет (флаговый бит - 0). Помимо этого, размер ссылки динамический,
она может занимать 2 (по 1Б на длину и смещение), 4(по 2Б на длину и смещение) 
или 6 (по 3Б на длину и смещение) байт. Это нужно, чтобы не записывать ссылку 
размером 6Б, когда длина и смещение не превышают 2^8 и могут поместиться в 2 байтах.
Для этого введены дополнительные флаги: 00 = ссылка 2Б, 1 = ссылка 4Б, 01 = ссылка 6Б.
Статистически самый частый размер ссылки - 4Б.

Примечание: макс. размер ссылки 6Б, по 3Б на длину и смещение или по 24 бита.
            Отсюда максимальный размер блока в 2^24Б. 

### Принцип работы
Начиная с первого элемента:
1) Находится самое длинное совпадение начиная с текущего элемента
2) - Если совпадений нет или оно слишком короткое записывается бит 0 и 
   текущий байт без изменений, счетчик элементов увеличивается на 1. 
   - Иначе записывается бит 1 и производится оценка длины и смещения
     - Eсли каждая из этих величин помещается в 1Б (не превышает 2^8), 
       то записываются 2 бита 0 и 1Б длины, 1Б смещения
     - Eсли каждая из этих величин помещается в 2Б,
       то записываются 1 бит 1 и 2Б длины, 2Б смещения
     - Иначе записываются биты 01 и 3Б длины, 3Б смещения
       
      Счетчик элементов увеличивается на длину совпадения.
3) Пока показатель счетчика меньше размера массива данных — повторять.

**Итого**: <br>
0 - следующий бит не закодирован <br>
100 - следующий бит закодирован, размер ссылки 2Б <br>
11 - следующий бит закодирован, размер ссылки 4Б <br>
101 - следующий бит закодирован, размер ссылки 6Б <br>
